#!/bin/bash
# Fetch data for Pikachu from the PokÃ©API.
# On success, save the JSON in data.json.
# On failure, append an entry to errors.txt and exit non-zero.

API_URL="https://pokeapi.co/api/v2/pokemon/pikachu"
OUT_FILE="data.json"
ERR_FILE="errors.txt"

# -s  silent, -S show errors, -w write HTTP status, -o output file
status=$(curl -sS -w "%{http_code}" -o "$OUT_FILE" "$API_URL")

if [ "$status" -ne 200 ]; then
  # Remove any partial file and log the failure with a timestamp.
  rm -f "$OUT_FILE"
  printf '%s - Error fetching %s (HTTP %s)\n' "$(date '+%Y-%m-%d %H:%M:%S')" "$API_URL" "$status" >> "$ERR_FILE"
  exit 1
fi
